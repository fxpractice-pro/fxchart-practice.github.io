<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Forex Master Pro - Dynamic Menu</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #060d0a; --panel: #0b120f; --border: #1e2a24; --green: #00ff88; --text: #d1d4dc; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100vh; background: var(--bg); color: var(--text); overflow: hidden; font-family: sans-serif; }
        
        /* 1단: 대분류 카테고리 (박스형) */
        .category-header { 
            background: var(--panel); border-bottom: 1px solid var(--border); 
            padding: 15px 20px; display: flex; gap: 12px; align-items: center;
        }
        .cat-box { 
            background: #111b16; border: 2px solid #1e2a24; color: #fff; 
            padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; 
            transition: all 0.2s; text-align: center; min-width: 60px;
        }
        .cat-box:hover { border-color: var(--green); transform: translateY(-2px); }
        .cat-box.active { background: var(--green); color: #000; border-color: var(--green); box-shadow: 0 0 15px rgba(0,255,136,0.3); }

        /* 2단: 서브메뉴 플로팅 바 (카테고리 클릭 시 노출) */
        #sub-menu-panel { 
            background: #0d1612; border-bottom: 1px solid var(--border); 
            padding: 8px 25px; display: flex; gap: 20px; height: 35px; align-items: center;
            overflow-x: auto; scrollbar-width: none;
        }
        .pair-link { 
            color: #666; cursor: pointer; font-size: 13px; font-weight: 500; 
            white-space: nowrap; transition: 0.2s; padding: 5px 0;
        }
        .pair-link:hover { color: #fff; }
        .pair-link.active { color: var(--green); border-bottom: 2px solid var(--green); }

        /* 레이아웃 */
        #main-content { display: flex; height: calc(100vh - 130px); }
        .side-toolbar { width: 55px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 25px; gap: 25px; }
        .tool-icon { color: #444; font-size: 20px; cursor: pointer; transition: 0.2s; }
        .tool-icon:hover, .tool-icon.active { color: var(--green); }

        #chart-area { flex: 1; position: relative; background: #000; }
    </style>
</head>
<body>

<div class="category-header">
    <div class="cat-box active" onclick="clickCategory('EUR', this)">EUR</div>
    <div class="cat-box" onclick="clickCategory('USD', this)">USD</div>
    <div class="cat-box" onclick="clickCategory('JPY', this)">JPY</div>
    <div class="cat-box" onclick="clickCategory('GBP', this)">GBP</div>
    <div class="cat-box" onclick="clickCategory('BTC', this)">CRYPTO</div>
</div>

<div id="sub-menu-panel">
    </div>

<div id="main-content">
    <div class="side-toolbar">
        <i class="fas fa-mouse-pointer tool-icon active"></i>
        <i class="fas fa-slash tool-icon"></i>
        <i class="fas fa-square tool-icon"></i>
        <i class="fas fa-eraser tool-icon" onclick="toggleEraser(this)" title="지우개 툴"></i>
    </div>
    <div id="chart-area">
        <div id="chart-div" style="width:100%; height:100%;"></div>
    </div>
</div>

<script>
    let chart, candleSeries, currentPair = 'EURUSDT';
    const groups = {
        'EUR': ['EURUSDT', 'EURJPY', 'EURAUD', 'EURNZD', 'EURCAD'],
        'USD': ['GBPUSDT', 'AUDUSDT', 'NZDUSDT', 'USDCAD', 'USDCHF'],
        'JPY': ['GBPJPY', 'AUDJPY', 'CHFJPY', 'CADJPY'],
        'GBP': ['GBPUSDT', 'GBPJPY', 'GBPAUD', 'GBPCAD'],
        'BTC': ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'XRPUSDT']
    };

    function init() {
        chart = LightweightCharts.createChart(document.getElementById('chart-div'), {
            layout: { background: { color: '#000' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            timeScale: { borderColor: '#1e2a24', timeVisible: true }
        });
        candleSeries = chart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a', downColor: '#ef5350', borderVisible: false
        });
        
        // 초기 실행: EUR 카테고리 활성화
        clickCategory('EUR', document.querySelector('.cat-box'));
    }

    // 카테고리 클릭 시 서브메뉴를 "동적으로" 생성
    function clickCategory(cat, el) {
        // 1. 박스 활성화 상태 변경
        document.querySelectorAll('.cat-box').forEach(b => b.classList.remove('active'));
        el.classList.add('active');

        // 2. 서브메뉴 패널 비우고 새로 채우기
        const panel = document.getElementById('sub-menu-panel');
        panel.innerHTML = ''; 

        groups[cat].forEach(pair => {
            const link = document.createElement('div');
            link.className = 'pair-link' + (pair === currentPair ? ' active' : '');
            link.innerText = pair.replace('USDT', '/USD').replace(/([A-Z]{3})([A-Z]{3})/, '$1/$2');
            
            link.onclick = () => {
                currentPair = pair;
                document.querySelectorAll('.pair-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                loadChartData(pair);
            };
            panel.appendChild(link);
        });

        // 카테고리 변경 시 첫 번째 종목으로 차트 업데이트
        currentPair = groups[cat][0];
        loadChartData(currentPair);
    }

    async function loadChartData(symbol) {
        const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=500`);
        const data = await res.json();
        const formatted = data.map(d => ({
            time: d[0] / 1000, open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4])
        }));
        candleSeries.setData(formatted);
        chart.timeScale().fitContent();
    }

    function toggleEraser(el) {
        el.classList.toggle('active');
        if(el.classList.contains('active')) {
            alert("지우개 모드가 활성화되었습니다. (드로잉 기능 구현 시 연동됩니다)");
        }
    }

    init();
</script>
</body>
</html>
