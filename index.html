<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ForexPractice Master</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-deep: #0b120f; --active-green: #00ff88;
            --border: #1f2328; --text-dim: #8b949e;
        }
        body, html { margin: 0; padding: 0; background: #000; color: #fff; height: 100vh; overflow: hidden; font-family: sans-serif; }

        /* 레이아웃 구조 */
        .header { height: 50px; background: var(--bg-deep); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; }
        .main-view { display: flex; height: calc(100vh - 50px); }
        .chart-container { flex: 1; position: relative; background: #000; min-width: 0; }
        #chart { width: 100%; height: 100%; } /* 차트가 그려질 실제 공간 */

        /* [핵심] Play/Pause 컨트롤 박스 (이미지 db0ff4 1:1 재현) */
        .player-wrapper {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 27, 24, 0.95); border: 1px solid #2d3531;
            padding: 12px 25px; border-radius: 12px; display: flex; align-items: center; gap: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 1000;
        }
        .ctrl-btn { cursor: pointer; color: #fff; font-size: 18px; transition: 0.2s; }
        .ctrl-btn:hover { color: var(--active-green); }
        .play-main { font-size: 35px; color: var(--active-green); }
        .speed-tab { display: flex; background: #0d1117; border-radius: 6px; padding: 2px; gap: 5px; }
        .speed-item { padding: 4px 10px; font-size: 11px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .speed-item.active { background: #fff; color: #000; }

        .sidebar { width: 300px; border-left: 1px solid var(--border); background: var(--bg-deep); padding: 15px; }
    </style>
</head>
<body>

<div class="header">
    <b style="color:var(--active-green); font-size: 18px;">ForexPractice</b>
</div>

<div class="main-view">
    <div class="chart-container">
        <div id="chart"></div>

        <div class="player-wrapper">
            <i class="fas fa-step-backward ctrl-btn"></i>
            <i class="fas fa-backward ctrl-btn"></i>
            <i id="play-pause-btn" class="fas fa-play-circle play-main ctrl-btn"></i>
            <i class="fas fa-forward ctrl-btn"></i>
            <i class="fas fa-step-forward ctrl-btn"></i>
            
            <div style="width: 1px; height: 25px; background: #333;"></div>
            
            <div class="speed-tab">
                <div class="speed-item">0.5x</div>
                <div class="speed-item active">1x</div>
                <div class="speed-item">2x</div>
                <div class="speed-item">5x</div>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <h3 style="font-size:14px;">Market Simulator</h3>
        </aside>
</div>

<script>
    // 1. 차트 생성 (반드시 DOM이 로드된 후 실행)
    const chartElement = document.getElementById('chart');
    const chart = LightweightCharts.createChart(chartElement, {
        layout: { background: { color: '#000000' }, textColor: '#d1d4dc' },
        grid: { vertLines: { color: '#161b18' }, horzLines: { color: '#161b18' } },
        timeScale: { timeVisible: true, secondsVisible: false }
    });

    const candleSeries = chart.addCandlestickSeries({
        upColor: '#00ff88', downColor: '#ef5350', borderVisible: false,
        wickUpColor: '#00ff88', wickDownColor: '#ef5350'
    });

    // 2. 초기 데이터
    let data = [];
    let time = Math.floor(Date.now() / 1000) - 500 * 60;
    for (let i = 0; i < 150; i++) {
        data.push({
            time: time + i * 60,
            open: 1.0840 + Math.random() * 0.001,
            high: 1.0855, low: 1.0835,
            close: 1.0845
        });
    }
    candleSeries.setData(data);

    // 3. Play/Pause 및 틱 데이터 로직
    let isPlaying = false;
    let lastClose = data[data.length - 1].close;
    let lastTime = data[data.length - 1].time;
    const playBtn = document.getElementById('play-pause-btn');

    playBtn.addEventListener('click', () => {
        isPlaying = !isPlaying;
        playBtn.className = isPlaying ? "fas fa-pause-circle play-main ctrl-btn" : "fas fa-play-circle play-main ctrl-btn";
    });

    // 0.5초마다 차트 업데이트 (틱 발생)
    setInterval(() => {
        if (!isPlaying) return;

        const nextPrice = lastClose + (Math.random() - 0.5) * 0.0001;
        candleSeries.update({
            time: lastTime,
            open: lastClose,
            high: Math.max(lastClose, nextPrice),
            low: Math.min(lastClose, nextPrice),
            close: nextPrice
        });
        // 캔들이 어느 정도 변하면 다음 시간으로 넘어가게 설계 가능
    }, 500);

    // 윈도우 크기 조절 대응
    window.addEventListener('resize', () => {
        chart.applyOptions({ width: chartElement.clientWidth, height: chartElement.clientHeight });
    });
</script>
</body>
</html>
