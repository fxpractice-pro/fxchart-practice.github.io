<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ForexPractice Master Pro</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --border: #30363d; --green: #22c55e; --red: #ef4444; --text: #c9d1d9; --accent: #58a6ff; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* 상단 바 */
        header { height: 60px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .logo { font-weight: bold; color: var(--green); display: flex; align-items: center; gap: 10px; font-size: 20px; }
        .asset-select { display: flex; gap: 8px; }
        .nav-btn { background: #21262d; border: 1px solid var(--border); color: var(--text); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; }
        .nav-btn:hover { background: #30363d; }

        #main { display: flex; flex: 1; position: relative; }

        /* 좌측 툴바 */
        .sidebar { width: 50px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; }
        .tool-icon { color: #8b949e; cursor: pointer; font-size: 18px; transition: 0.2s; }
        .tool-icon:hover { color: var(--accent); }

        /* 차트 영역 */
        #chart-container { flex: 1; position: relative; background: var(--bg); }
        
        /* 플로팅 컨트롤 박스 (드래그 가능) */
        #floating-ctrl {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 27, 34, 0.9); border: 1px solid var(--border);
            padding: 10px 20px; border-radius: 30px; z-index: 1000; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5); cursor: move;
        }
        .play-btn { background: var(--green); border: none; width: 40px; height: 40px; border-radius: 50%; color: white; cursor: pointer; }

        /* 우측 매매 패널 */
        .trade-panel { width: 300px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .panel-content { padding: 20px; flex: 1; }
        .trade-box { background: #0d1117; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .buy-btn { background: var(--green); color: white; border: none; padding: 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .sell-btn { background: var(--red); color: white; border: none; padding: 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* 광고 영역 */
        .ad-space { background: #0d1117; border: 1px dashed #444; display: flex; align-items: center; justify-content: center; color: #555; font-size: 12px; }
        .ad-side { height: 150px; margin: 10px; }
        .ad-bottom { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 600px; height: 90px; z-index: 900; }
    </style>
</head>
<body>

<header>
    <div class="logo"><i class="fas fa-chart-line"></i> ForexPractice</div>
    <div class="asset-select">
        <button class="nav-btn" onclick="changeSymbol('EURUSDT')">EUR/USD</button>
        <button class="nav-btn" onclick="changeSymbol('GBPUSDT')">GBP/USD</button>
        <button class="nav-btn" onclick="changeSymbol('USDJPY')">USD/JPY</button>
        <button class="nav-btn" onclick="changeSymbol('BTCUSDT')">BTC/USD</button>
        <button class="nav-btn"><i class="fas fa-search"></i> Indicators</button>
    </div>
    <div style="display:flex; gap:15px; align-items:center;">
        <span id="price-display" style="color:var(--green); font-weight:bold; font-family:monospace;">0.00000</span>
        <i class="fas fa-user-circle" style="font-size: 24px;"></i>
    </div>
</header>

<div id="main">
    <div class="sidebar">
        <i class="fas fa-mouse-pointer tool-icon"></i>
        <i class="fas fa-pen tool-icon" title="Trend Line"></i>
        <i class="fas fa-square tool-icon"></i>
        <i class="fas fa-circle tool-icon"></i>
        <i class="fas fa-arrow-right tool-icon"></i>
        <i class="fas fa-align-left tool-icon" title="Fibonacci"></i>
    </div>

    <div id="chart-container">
        <div class="ad-space ad-bottom">ADVERTISEMENT (CPC 전면 광고)</div>
        
        <div id="floating-ctrl">
            <i class="fas fa-step-backward tool-icon"></i>
            <button class="play-btn" onclick="togglePlay()" id="master-play"><i class="fas fa-play"></i></button>
            <i class="fas fa-step-forward tool-icon"></i>
            <select style="background:none; color:white; border:none; outline:none;" onchange="setSpeed(this.value)">
                <option value="10">1x</option>
                <option value="100">10x</option>
                <option value="500">50x</option>
            </select>
            <span id="sim-date" style="font-size:12px; color:#8b949e;">2023-10-12 08:00</span>
        </div>
    </div>

    <aside class="trade-panel">
        <div class="panel-content">
            <h3 style="font-size:16px; margin-bottom:15px;">Market Simulator</h3>
            <div class="trade-box">
                <div class="stat-row"><span>Balance</span><span style="color:white;">$10,000.00</span></div>
                <div class="stat-row"><span>Equity</span><span style="color:white;">$10,000.00</span></div>
            </div>
            
            <div class="trade-box">
                <div class="stat-row"><span>Lots</span><input type="number" value="1.00" style="width:60px; background:#161b22; border:1px solid #333; color:white;"></div>
                <div class="stat-row"><span>Pips</span><span id="pip-display">0.0</span></div>
            </div>

            <div class="btn-group">
                <button class="sell-btn">SELL<br><small id="sell-price">0.0000</small></button>
                <button class="buy-btn">BUY<br><small id="buy-price">0.0000</small></button>
            </div>

            <div class="ad-space ad-side" style="margin-top:20px;">CPC AD SPACE</div>
        </div>
    </aside>
</div>

<script>
    // 차트 초기화
    const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
        layout: { background: { color: '#0d1117' }, textColor: '#c9d1d9' },
        grid: { vertLines: { color: '#161b22' }, horzLines: { color: '#161b22' } },
        crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
        timeScale: { borderColor: '#30363d', timeVisible: true, secondsVisible: false }
    });

    const candleSeries = chart.addSeries(LightweightCharts.CandlestickSeries, {
        upColor: '#26a69a', downColor: '#ef5350', borderVisible: false, wickUpColor: '#26a69a', wickDownColor: '#ef5350'
    });

    let allData = [], idx = 150, isPlaying = false, speed = 10, lastT = 0;

    async function changeSymbol(symbol) {
        const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=1000`);
        const data = await res.json();
        allData = data.map(d => ({
            time: d[0] / 1000, open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4])
        }));
        candleSeries.setData(allData.slice(0, idx));
    }

    function togglePlay() {
        isPlaying = !isPlaying;
        document.getElementById('master-play').innerHTML = isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
        if(isPlaying) animate();
    }

    function animate(t) {
        if(!isPlaying) return;
        if(t - lastT > 1000/speed) {
            idx++;
            if(idx < allData.length) {
                const c = allData[idx];
                candleSeries.update(c);
                document.getElementById('price-display').innerText = c.close.toFixed(5);
                document.getElementById('buy-price').innerText = c.close.toFixed(5);
                document.getElementById('sell-price').innerText = (c.close - 0.0002).toFixed(5);
                document.getElementById('sim-date').innerText = new Date(c.time * 1000).toLocaleString();
            }
            lastT = t;
        }
        requestAnimationFrame(animate);
    }

    function setSpeed(v) { speed = parseInt(v); }

    // 컨트롤 박스 드래그 로직
    const ctrl = document.getElementById('floating-ctrl');
    let isDragging = false, offset = [0,0];
    ctrl.onmousedown = (e) => { isDragging = true; offset = [ctrl.offsetLeft - e.clientX, ctrl.offsetTop - e.clientY]; };
    document.onmousemove = (e) => { if(isDragging) { ctrl.style.left = (e.clientX + offset[0]) + 'px'; ctrl.style.top = (e.clientY + offset[1]) + 'px'; ctrl.style.bottom = 'auto'; } };
    document.onmouseup = () => isDragging = false;

    changeSymbol('EURUSDT');
</script>
</body>
</html>
