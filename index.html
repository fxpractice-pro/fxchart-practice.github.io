<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Forex Practice Master</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root { --bg: #060d0a; --panel: #0b120f; --border: #1e2a24; --green: #00ff88; --red: #ef5350; --text: #d1d4dc; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; height: 100vh; overflow: hidden; }
        .tf-bar { height: 50px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; gap: 10px; }
        .tf-btn { background: #16261f; border: 1px solid var(--border); color: var(--text); padding: 5px 12px; cursor: pointer; border-radius: 4px; font-size: 12px; }
        #main-container { display: flex; height: calc(100vh - 50px); }
        #chart-area { flex: 1; position: relative; }
        #floating-ctrl {
            position: absolute; top: 20px; left: 20px; width: 220px;
            background: rgba(11, 18, 15, 0.95); border: 1px solid var(--border);
            border-radius: 12px; padding: 15px; z-index: 2000;
        }
        #play-btn { width:100%; padding:12px; background:var(--green); border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
    </style>
</head>
<body>
    <div class="tf-bar">
        <button class="tf-btn" onclick="loadData('EURUSDT')">EUR/USD</button>
        <button class="tf-btn" onclick="loadData('GBPUSDT')">GBP/USD</button>
        <button class="tf-btn" onclick="loadData('BTCUSDT')">BTC/USD</button>
    </div>
    <div id="main-container">
        <div id="chart-area">
            <div id="floating-ctrl">
                <div id="target-name" style="font-size: 11px; color: var(--green); margin-bottom: 8px; font-weight: bold; text-align:center;">CONNECTING...</div>
                <button id="play-btn" onclick="togglePlay()">▶ PLAY</button>
            </div>
        </div>
    </div>
    <script>
        const chart = LightweightCharts.createChart(document.getElementById('chart-area'), {
            layout: { background: { color: '#060d0a' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#111b16' }, horzLines: { color: '#111b16' } },
            timeScale: { borderColor: '#1e2a24', timeVisible: true }
        });
        const candleSeries = chart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a', downColor: '#ef5350', borderVisible: false, wickUpColor: '#26a69a', wickDownColor: '#ef5350'
        });

        let allData = [], idx = 0, isPlaying = false, lastT = 0, rafId = null;

        async function loadData(symbol) {
            stop();
            document.getElementById('target-name').innerText = "LOADING...";
            try {
                // GitHub Pages 환경에서는 이 주소로 바로 데이터 호출이 가능합니다.
                const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=1000`);
                const raw = await res.json();
                allData = raw.map(d => ({
                    time: d[0] / 1000,
                    open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4])
                }));
                idx = 200;
                candleSeries.setData(allData.slice(0, idx));
                document.getElementById('target-name').innerText = symbol;
            } catch (e) {
                document.getElementById('target-name').innerText = "DATA ERROR";
            }
        }

        function step(timestamp) {
            if (!isPlaying) return;
            if (!lastT) lastT = timestamp;
            const dt = (timestamp - lastT) / 1000;
            if (dt > 0.1) { // 0.1초마다 업데이트
                lastT = timestamp;
                idx++;
                if (idx >= allData.length) { stop(); return; }
                candleSeries.update(allData[idx]);
            }
            rafId = requestAnimationFrame(step);
        }

        function togglePlay() {
            if (isPlaying) stop();
            else { isPlaying = true; lastT = 0; document.getElementById('play-btn').innerText = "⏸ PAUSE"; rafId = requestAnimationFrame(step); }
        }
        function stop() { isPlaying = false; if (rafId) cancelAnimationFrame(rafId); document.getElementById('play-btn').innerText = "▶ PLAY"; }

        loadData('EURUSDT');
    </script>
</body>
</html>
