<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Forex Master - Symbol Popup Edition</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #060d0a; --panel: #0b120f; --border: #1e2a24; --green: #00ff88; --text: #d1d4dc; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100vh; background: #000; color: var(--text); overflow: hidden; font-family: 'Inter', sans-serif; }

        /* 상단 네비게이션 */
        header { 
            height: 50px; background: var(--panel); border-bottom: 1px solid var(--border); 
            display: flex; align-items: center; padding: 0 20px; gap: 15px; z-index: 10;
        }
        .cat-box { 
            background: #1a2e25; border: 1px solid #2e4a3d; color: #fff; padding: 5px 15px; 
            border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: bold;
        }
        .cat-box:hover { border-color: var(--green); }

        /* 메인 레이아웃 */
        #main-layout { display: flex; height: calc(100vh - 50px); }
        .toolbar { width: 50px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; }
        .tool-btn { color: #444; font-size: 20px; cursor: pointer; }
        .tool-btn.active { color: var(--green); }

        #chart-container { flex: 1; position: relative; }
        
        /* [중요] 팝업 모달창 스타일 */
        #symbol-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: #131722; width: 500px; border-radius: 8px; border: 1px solid #363c4e;
            overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #363c4e; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { margin: 0; font-size: 16px; color: #fff; }
        .close-btn { cursor: pointer; color: #888; font-size: 20px; }

        .symbol-list { max-height: 400px; overflow-y: auto; padding: 10px 0; }
        .symbol-item { 
            padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; transition: 0.2s;
        }
        .symbol-item:hover { background: #2a2e39; }
        .symbol-name { font-weight: bold; color: #fff; font-size: 14px; }
        .symbol-desc { color: #888; font-size: 12px; }
        .exchange-tag { font-size: 10px; color: var(--green); border: 1px solid var(--green); padding: 1px 4px; border-radius: 3px; }

        /* 하단 시간대바 */
        #interval-bar { position: absolute; top: 10px; right: 20px; display: flex; gap: 5px; z-index: 5; }
        .int-btn { background: var(--panel); border: 1px solid var(--border); color: #888; padding: 3px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; }
        .int-btn.active { color: var(--green); border-color: var(--green); }
    </style>
</head>
<body>

<header>
    <div style="font-size: 12px; color: #555; font-weight: bold; margin-right: 10px;">MARKET BOX</div>
    <div class="cat-box" onclick="openModal('EUR')">EUR</div>
    <div class="cat-box" onclick="openModal('USD')">USD</div>
    <div class="cat-box" onclick="openModal('JPY')">JPY</div>
    <div class="cat-box" onclick="openModal('BTC')">CRYPTO</div>
    <div style="margin-left: auto; color: var(--green); font-weight: bold; font-size: 14px;" id="current-display">EUR/USD</div>
</header>

<div id="main-layout">
    <div class="toolbar">
        <i class="fas fa-mouse-pointer tool-btn active"></i>
        <i class="fas fa-slash tool-btn"></i>
        <i class="fas fa-square tool-btn"></i>
        <i class="fas fa-eraser tool-btn" onclick="this.classList.toggle('active')" title="지우개"></i>
    </div>

    <div id="chart-container">
        <div id="interval-bar">
            <button class="int-btn" onclick="changeTf('1m', this)">1m</button>
            <button class="int-btn" onclick="changeTf('5m', this)">5m</button>
            <button class="int-btn active" onclick="changeTf('1h', this)">1h</button>
            <button class="int-btn" onclick="changeTf('1d', this)">1d</button>
        </div>
        <div id="chart-inner" style="width:100%; height:100%;"></div>
    </div>
</div>

<div id="symbol-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Symbol Search</h3>
            <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>
        <div class="symbol-list" id="modal-list">
            </div>
    </div>
</div>

<script>
    let chart, candleSeries, currentPair = 'EURUSDT', currentTf = '1h';
    const groups = {
        'EUR': [
            {id:'EURUSDT', name:'EUR/USD', desc:'Euro / US Dollar'},
            {id:'EURJPY', name:'EUR/JPY', desc:'Euro / Japanese Yen'},
            {id:'EURAUD', name:'EUR/AUD', desc:'Euro / Australian Dollar'},
            {id:'EURNZD', name:'EUR/NZD', desc:'Euro / New Zealand Dollar'}
        ],
        'USD': [
            {id:'GBPUSDT', name:'GBP/USD', desc:'British Pound / US Dollar'},
            {id:'AUDUSDT', name:'AUD/USD', desc:'Australian Dollar / US Dollar'},
            {id:'USDCAD', name:'USD/CAD', desc:'US Dollar / Canadian Dollar'},
            {id:'USDCHF', name:'USD/CHF', desc:'US Dollar / Swiss Franc'}
        ],
        'JPY': [
            {id:'GBPJPY', name:'GBP/JPY', desc:'British Pound / Japanese Yen'},
            {id:'AUDJPY', name:'AUD/JPY', desc:'Australian Dollar / Japanese Yen'},
            {id:'CADJPY', name:'CAD/JPY', desc:'Canadian Dollar / Japanese Yen'}
        ],
        'BTC': [
            {id:'BTCUSDT', name:'BTC/USD', desc:'Bitcoin / Tether'},
            {id:'ETHUSDT', name:'ETH/USD', desc:'Ethereum / Tether'},
            {id:'SOLUSDT', name:'SOL/USD', desc:'Solana / Tether'}
        ]
    };

    function initChart() {
        chart = LightweightCharts.createChart(document.getElementById('chart-inner'), {
            layout: { background: { color: '#060d0a' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#111b16' }, horzLines: { color: '#111b16' } },
            timeScale: { borderColor: '#1e2a24', timeVisible: true }
        });
        candleSeries = chart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a', downColor: '#ef5350', borderVisible: false
        });
        loadData();
    }

    // 팝업 열기
    function openModal(cat) {
        const modal = document.getElementById('symbol-modal');
        const list = document.getElementById('modal-list');
        document.getElementById('modal-title').innerText = cat + " 관련 종목 선택";
        
        list.innerHTML = '';
        groups[cat].forEach(item => {
            const div = document.createElement('div');
            div.className = 'symbol-item';
            div.innerHTML = `
                <div>
                    <div class="symbol-name">${item.name}</div>
                    <div class="symbol-desc">${item.desc}</div>
                </div>
                <div class="exchange-tag">BINANCE</div>
            `;
            div.onclick = () => {
                currentPair = item.id;
                document.getElementById('current-display').innerText = item.name;
                closeModal();
                loadData();
            };
            list.appendChild(div);
        });
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('symbol-modal').style.display = 'none';
    }

    async function loadData() {
        const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${currentPair}&interval=${currentTf}&limit=500`);
        const data = await res.json();
        const formatted = data.map(d => ({
            time: d[0] / 1000, open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4])
        }));
        candleSeries.setData(formatted);
        chart.timeScale().fitContent();
    }

    function changeTf(tf, btn) {
        currentTf = tf;
        document.querySelectorAll('.int-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        loadData();
    }

    initChart();
</script>
</body>
</html>
