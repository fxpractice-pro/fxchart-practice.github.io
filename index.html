<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Forex Master Pro - Final Speed Tune</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #060d0a; --panel: #0b120f; --border: #1e2a24; --green: #00ff88; --red: #ef5350; --text: #d1d4dc; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; }
        #wrapper { display: flex; flex-direction: column; height: 100vh; }
        header { height: 50px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 15px; justify-content: space-between; z-index: 100; }
        #main-container { display: flex; flex: 1; position: relative; overflow: hidden; }
        .toolbar { width: 50px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; }
        .tool-btn { color: #444; cursor: pointer; font-size: 18px; transition: 0.2s; }
        .tool-btn:hover { color: var(--green); }
        #chart-viewport { flex: 1; position: relative; background: #000; }
        #chart-dom { width: 100%; height: 100%; }
        #floating-ctrl {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 25, 20, 0.95); border: 1px solid var(--border);
            padding: 10px 25px; border-radius: 40px; z-index: 9999; display: flex; align-items: center; gap: 15px; cursor: move; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        .play-btn { background: var(--green); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #000; font-size: 16px; }
        .speed-sel { background: #1a2e25; border: 1px solid var(--border); color: #fff; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; outline: none; }
        .side-panel { width: 280px; background: var(--panel); border-left: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .price-card { background: #000; border: 1px solid var(--border); padding: 15px; border-radius: 10px; text-align: center; }
        .btn-trade { padding: 15px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: #fff; font-size: 14px; }
    </style>
</head>
<body>

<div id="wrapper">
    <header>
        <div style="display:flex; gap:8px;">
            <button onclick="loadData('EURUSDT')" style="background:#16261f; color:#fff; border:1px solid #1e2a24; padding:5px 10px; border-radius:4px; cursor:pointer;">EUR/USD</button>
            <button onclick="loadData('GBPUSDT')" style="background:#16261f; color:#fff; border:1px solid #1e2a24; padding:5px 10px; border-radius:4px; cursor:pointer;">GBP/USD</button>
            <button onclick="loadData('USDJPY')" style="background:#16261f; color:#fff; border:1px solid #1e2a24; padding:5px 10px; border-radius:4px; cursor:pointer;">USD/JPY</button>
            <button style="background:#16261f; color:var(--green); border:1px solid #1e2a24; padding:5px 10px; border-radius:4px; cursor:pointer;">+ Indicators</button>
        </div>
        <div id="price-top" style="color:var(--green); font-family:monospace; font-weight:bold; font-size:20px;">0.00000</div>
    </header>

    <div id="main-container">
        <div class="toolbar">
            <i class="fas fa-mouse-pointer tool-btn" style="color:var(--green)"></i>
            <i class="fas fa-slash tool-btn" title="Trend Line"></i>
            <i class="fas fa-square tool-btn" title="Rectangle"></i>
            <i class="fas fa-eraser tool-btn" title="Eraser"></i>
        </div>

        <div id="chart-viewport">
            <div id="chart-dom"></div>
            <div id="floating-ctrl">
                <button class="play-btn" onclick="togglePlay()"><i class="fas fa-play" id="play-icon"></i></button>
                <select class="speed-sel" id="speed-val" onchange="setSpeed(this.value)">
                    <option value="0.5">0.5x</option>
                    <option value="1" selected>1x</option>
                    <option value="2">2x</option>
                    <option value="5">5x</option>
                    <option value="10">10x</option>
                </select>
                <div id="display-time" style="font-size:11px; color:#666; font-family:monospace; min-width:130px;">READY</div>
            </div>
        </div>

        <aside class="side-panel">
            <div class="price-card">
                <div style="font-size:11px; color:#444; margin-bottom:5px;">LIVE PRICE</div>
                <div id="price-side" style="font-size:26px; font-weight:bold; color:var(--green);">0.00000</div>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-trade" style="background:var(--red); flex:1;">SELL</button>
                <button class="btn-trade" style="background:var(--green); flex:1; color:#000;">BUY</button>
            </div>
            <div style="flex:1; border:1px dashed #222; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#333; font-size:11px; text-align:center;">AD SPACE</div>
        </aside>
    </div>
</div>

<script>
    let chart, candleSeries, allData = [], idx = 200, isPlaying = false;
    let speed = 1, progress = 0, lastTime = 0, curH = 0, curL = 0;

    function init() {
        const dom = document.getElementById('chart-dom');
        chart = LightweightCharts.createChart(dom, {
            layout: { background: { color: '#060d0a' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#111b16' }, horzLines: { color: '#111b16' } },
            timeScale: { borderColor: '#1e2a24', timeVisible: true, rightOffset: 15 },
            rightPriceScale: { borderColor: '#1e2a24', autoScale: true, scaleMargins: { top: 0.2, bottom: 0.2 } }
        });

        candleSeries = chart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a', downColor: '#ef5350', borderVisible: false, wickUpColor: '#26a69a', wickDownColor: '#ef5350',
            priceFormat: { type: 'price', precision: 5, minMove: 0.00001 }
        });

        new ResizeObserver(() => { chart.applyOptions({ width: dom.clientWidth, height: dom.clientHeight }); }).observe(dom);
        loadData('EURUSDT');
    }

    async function loadData(symbol) {
        isPlaying = false;
        document.getElementById('play-icon').className = 'fas fa-play';
        const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=1000`);
        const raw = await res.json();
        allData = raw.map(d => ({
            time: d[0] / 1000, open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4])
        }));
        idx = 200;
        candleSeries.setData(allData.slice(0, idx));
        chart.timeScale().fitContent();
        updateUI();
    }

    function loop(t) {
        if (!isPlaying) return;
        if (!lastTime) lastTime = t;
        const dt = (t - lastTime) / 1000;
        lastTime = t;

        progress += dt * (speed * 0.7); // 10x까지만 존재하므로 밸런스 조정

        if (progress >= 1) {
            while(progress >= 1) { progress -= 1; idx++; if (idx >= allData.length) { isPlaying=false; return; } }
            curH = allData[idx].open; curL = allData[idx].open;
        }

        const d = allData[idx];
        let p = (progress < 0.5) ? d.open + (d.high - d.open) * (progress * 2) : d.high - (d.high - d.close) * ((progress - 0.5) * 2);
        curH = Math.max(curH, p); curL = Math.min(curL, p);
        
        candleSeries.update({ time: d.time, open: d.open, high: curH, low: curL, close: p });
        updateUI(p);
        requestAnimationFrame(loop);
    }

    function togglePlay() {
        isPlaying = !isPlaying;
        document.getElementById('play-icon').className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
        if (isPlaying) { lastTime = 0; requestAnimationFrame(loop); }
    }

    function setSpeed(v) { speed = parseFloat(v); }

    function updateUI(p) {
        const val = (p || allData[idx].close).toFixed(5);
        document.getElementById('price-top').innerText = val;
        document.getElementById('price-side').innerText = val;
        document.getElementById('display-time').innerText = new Date(allData[idx].time * 1000).toLocaleString();
    }

    const ctrl = document.getElementById('floating-ctrl');
    let move = false, ox, oy;
    ctrl.onmousedown = (e) => { if(e.target.tagName==='SELECT') return; move=true; ox=e.clientX-ctrl.offsetLeft; oy=e.clientY-ctrl.offsetTop; };
    document.onmousemove = (e) => { if(move){ ctrl.style.left=(e.clientX-ox)+'px'; ctrl.style.top=(e.clientY-oy)+'px'; ctrl.style.bottom='auto'; ctrl.style.transform='none'; } };
    document.onmouseup = () => move=false;

    init();
</script>
</body>
</html>
