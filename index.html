<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Forex Master Pro - Ultimate Simulator</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #060d0a; --panel: #0b120f; --border: #1e2a24; --green: #00ff88; --red: #ef5350; --text: #d1d4dc; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100vh; background: #000; color: var(--text); overflow: hidden; font-family: 'Inter', sans-serif; }

        /* 레이아웃 구조 */
        #app-container { display: flex; width: 100%; height: 100vh; }
        
        /* 왼쪽 툴바 */
        .left-toolbar { width: 50px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; z-index: 100; }
        .tool-btn { color: #444; font-size: 18px; cursor: pointer; transition: 0.2s; }
        .tool-btn:hover, .tool-btn.active { color: var(--green); }

        /* 메인 차트 영역 */
        #center-content { flex: 1; position: relative; display: flex; flex-direction: column; }
        #chart-inner { flex: 1; }

        /* 상단 종목/시간대 선택바 (Floating 느낌) */
        .top-nav { 
            position: absolute; top: 15px; left: 15px; display: flex; gap: 10px; z-index: 50; 
            background: rgba(11, 18, 15, 0.85); padding: 5px; border-radius: 8px; border: 1px solid var(--border);
        }
        .nav-btn { background: #1a2e25; border: 1px solid #2e4a3d; color: #fff; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; }
        .nav-btn.active { background: var(--green); color: #000; font-weight: bold; }

        /* 우측 사이드바 (가격 계산기 & 광고) */
        .right-sidebar { width: 280px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px; gap: 20px; }
        
        .calculator { background: #111b16; border: 1px solid var(--border); border-radius: 8px; padding: 15px; }
        .calc-title { font-size: 10px; color: #555; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        .price-display { font-size: 24px; font-weight: bold; color: var(--green); margin-bottom: 15px; text-align: center; font-family: monospace; }
        .trade-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-trade { flex: 1; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; color: #fff; }
        .btn-buy { background: var(--green); color: #000; }
        .btn-sell { background: var(--red); }
        .input-group { margin-bottom: 10px; }
        .input-group label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; }
        .input-group input { width: 100%; background: #060d0a; border: 1px solid #1e2a24; color: #fff; padding: 8px; border-radius: 4px; box-sizing: border-box; }

        /* CPC 광고 영역 */
        .ad-space-side { flex: 1; background: #0d1210; border: 1px dashed #2e4a3d; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #333; font-size: 12px; text-align: center; }
        .ad-space-bottom { height: 60px; margin: 10px; background: rgba(0,255,136,0.02); border: 1px dashed #2e4a3d; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #333; font-size: 11px; }

        /* [핵심] 스피드 컨트롤 Floating 박스 */
        #speed-ctrl-floating {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(11, 18, 15, 0.95); border: 2px solid var(--green);
            padding: 10px 20px; border-radius: 40px; z-index: 1000;
            display: flex; align-items: center; gap: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .ctrl-btn { color: var(--green); background: none; border: none; font-size: 18px; cursor: pointer; }
        .speed-tag { background: #1a2e25; color: #fff; padding: 3px 12px; border-radius: 12px; font-size: 11px; border: 1px solid var(--border); }

        /* 팝업 모달 */
        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-body { background: #131722; width: 450px; border-radius: 8px; border: 1px solid #363c4e; padding: 20px; }
    </style>
</head>
<body>

<div id="app-container">
    <div class="left-toolbar">
        <i class="fas fa-mouse-pointer tool-btn active"></i>
        <i class="fas fa-slash tool-btn"></i>
        <i class="fas fa-square tool-btn"></i>
        <i class="fas fa-eraser tool-btn" onclick="toggleEraser(this)" title="지우개 (개체 삭제)"></i>
        <i class="fas fa-text-height tool-btn"></i>
    </div>

    <div id="center-content">
        <div class="top-nav">
            <button class="nav-btn" onclick="openPopup('EUR')">EUR</button>
            <button class="nav-btn" onclick="openPopup('USD')">USD</button>
            <button class="nav-btn" onclick="openPopup('GBP')">GBP</button> <button class="nav-btn" onclick="openPopup('JPY')">JPY</button>
            <span style="border-left: 1px solid #333; margin: 0 5px;"></span>
            <button class="nav-btn" onclick="changeTf('1m')">1m</button>
            <button class="nav-btn active" onclick="changeTf('1h')">1h</button>
            <button class="nav-btn" onclick="changeTf('1d')">1d</button>
        </div>

        <div id="chart-inner"></div>

        <div class="ad-space-bottom">CPC AD SPACE (Bottom) - Sponsored Content</div>

        <div id="speed-ctrl-floating">
            <button class="ctrl-btn" onclick="stepBack()"><i class="fas fa-step-backward"></i></button>
            <button class="ctrl-btn" onclick="togglePlay()"><i class="fas fa-play" id="play-icon"></i></button>
            <button class="ctrl-btn" onclick="stepForward()"><i class="fas fa-step-forward"></i></button>
            <div class="speed-tag" id="speed-text">1.0x</div>
            <select style="background:none; border:none; color:var(--green); font-size:12px; outline:none;" onchange="updateSpeed(this.value)">
                <option value="0.5">0.5x</option>
                <option value="1" selected>1.0x</option>
                <option value="5">5.0x</option>
                <option value="10">10x</option>
            </select>
        </div>
    </div>

    <div class="right-sidebar">
        <div class="calculator">
            <div class="calc-title">Market Simulator</div>
            <div class="price-display" id="live-price">1.18440</div>
            <div class="trade-row">
                <button class="btn-trade btn-sell">SELL</button>
                <button class="btn-trade btn-buy">BUY</button>
            </div>
            <div class="input-group">
                <label>Lots</label>
                <input type="number" value="1.00" step="0.01">
            </div>
            <div class="input-group">
                <label>Risk %</label>
                <input type="number" value="1.0">
            </div>
        </div>
        
        <div class="ad-space-side">CPC AD SPACE (Side)</div>
    </div>
</div>

<div id="modal" onclick="closePopup()">
    <div class="modal-body" onclick="event.stopPropagation()">
        <h3 style="margin-top:0;">Select Symbol</h3>
        <div id="symbol-list"></div>
    </div>
</div>

<script>
    let chart, candleSeries, isPlaying = false, currentSymbol = 'EURUSDT', currentTf = '1h';
    const symbolGroups = {
        'EUR': ['EURUSDT', 'EURJPY', 'EURAUD'],
        'USD': ['GBPUSDT', 'AUDUSDT', 'USDCAD'],
        'GBP': ['GBPUSDT', 'GBPJPY', 'GBPAUD', 'GBPCAD'], // GBP 데이터 추가
        'JPY': ['USDJPY', 'EURJPY', 'GBPJPY']
    };

    function init() {
        chart = LightweightCharts.createChart(document.getElementById('chart-inner'), {
            layout: { background: { color: '#060d0a' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#111b16' }, horzLines: { color: '#111b16' } },
            rightPriceScale: { borderColor: '#1e2a24' },
            timeScale: { borderColor: '#1e2a24', timeVisible: true }
        });
        candleSeries = chart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a', downColor: '#ef5350', borderVisible: false
        });
        loadData();
    }

    function openPopup(cat) {
        const list = document.getElementById('symbol-list');
        list.innerHTML = '';
        symbolGroups[cat].forEach(s => {
            const d = document.createElement('div');
            d.style.padding = '12px'; d.style.borderBottom = '1px solid #333'; d.style.cursor = 'pointer';
            d.innerText = s.replace('USDT', '/USD');
            d.onclick = () => { currentSymbol = s; loadData(); closePopup(); };
            list.appendChild(d);
        });
        document.getElementById('modal').style.display = 'flex';
    }
    function closePopup() { document.getElementById('modal').style.display = 'none'; }

    async function loadData() {
        const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${currentSymbol}&interval=${currentTf}&limit=500`);
        const data = await res.json();
        const formatted = data.map(d => ({
            time: d[0] / 1000, open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4])
        }));
        candleSeries.setData(formatted);
        document.getElementById('live-price').innerText = formatted[formatted.length-1].close.toFixed(5);
    }

    function togglePlay() {
        isPlaying = !isPlaying;
        document.getElementById('play-icon').className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
    }

    function toggleEraser(el) {
        el.classList.toggle('active');
        if(el.classList.contains('active')) {
            document.body.style.cursor = 'crosshair';
            // 실제 드로잉 삭제 로직 연동 지점
        } else {
            document.body.style.cursor = 'default';
        }
    }

    init();
</script>
</body>
</html>
